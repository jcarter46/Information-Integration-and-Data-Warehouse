<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<title>Data Visualization for Clinical Decision Support - UTC REU 2012</title>

	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	
	<!-- 1140px Grid styles for IE -->
	<!--[if lte IE 9]><link rel="stylesheet" href="1140_CssGrid_2/css/ie.css" type="text/css" media="screen" /><![endif]-->

	<!-- The 1140px Grid - http://cssgrid.net/ -->
	<link rel="stylesheet" href="1140_CssGrid_2/css/1140.css" type="text/css" media="screen" />
	
	<!-- Your styles -->
	<link rel="stylesheet" href="1140_CssGrid_2/css/styles.css" type="text/css" media="screen" />
	
	<!--css3-mediaqueries-js - http://code.google.com/p/css3-mediaqueries-js/ - Enables media queries in some unsupported browsers-->
	<script type="text/javascript" src="1140_CssGrid_2/js/css3-mediaqueries.js"></script>
	
	<!--Delete embedded styles, just for example.-->
	<style type="text/css">
	
	body {
	font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
	}
	
	.container h1 {
		color: #fff;
		background: #000;
		margin: 10px 0 0 0;
		padding: 5px 5px 5px 25px;
		font-size: 1.15em;
	}

	.container p {
		color: #fff;
		/*line-height: 100px;*/
		background: #000;
		text-align: center;
		margin: 10px 0 0 0;
		padding: 5px;
	}

	.container .container3D {
		margin: 10px 0 0 0;
		/*height: 500px;
		height: 50%;
		max-height: 500px;*/
	}

	#timeline {
		position: fixed;
		bottom: 5px;
		right:0;
		left:0;
		/*padding: 0px;*/
		margin: 0px;
		/*width: 100%;*/
	}

	#timeline p {
		padding-left: 10px;
		padding-right: 10px;
	}
	
	.row {
		/*min-height: 1px;*/
	}

	.bottom {
		margin-bottom: 80px;
	}

	.body {
		/*height: 100%;*/
	}

	input[type="range"] {
		width: 100%;
	}

	#loadLink {
		color: #fff;
		float: right;
		margin: 10px 0 0 0;
		padding: 5px 25px 5px 5px;
		text-decoration: underline;
	}

	a:visited {
		color: #f00;
	}

	</style>

<script src="mrdoob-three.js-46c0a84\build\Three.js"></script>
<script src="jquery-1.7.2.min.js"></script>
<script src="rainbowvis.js"></script>
<script src="jqueryFileTree/jqueryFileTree.js"></script>
<script src="freqdec-fd-slider-4cd0633/js/fd-slider.js"></script>
<script src="TrackballControlsCustom.js"></script>
<script src="jquery.scrollTo-1.4.2-min.js"></script>

<link href="jqueryFileTree/jqueryFileTree.css" rel="stylesheet" type="text/css" media="screen" />
<link href="styles.css" rel="stylesheet" type="text/css" media="screen" />
<link href="freqdec-fd-slider-4cd0633/css/fd-slider.css" rel="stylesheet" type="text/css" media="screen" />

	<script type="text/javascript">
    	var globalClock = new THREE.Clock(); //Main clock to sync all visualizations to
    	var pause = false;
    	var storedTime; //For pausing
    	animMultiplier = 10; // Adjust to speed up/slow down animation
		var dataLength = 100;

		//Scale factor for size of visualization panels
		visPanelFactor = 0.4;

		//Load the visualization panels
	    $(document).ready( function() {
	        $.get("kinect.html", {}, function(pgData){
	        	$("#kinect").html(pgData);
	        });
	        $.get("ecg.html", {}, function(pgData){
	        	$("#ecg").html(pgData);
	        });
	        $.get("eeg.html", {}, function(pgData){
	        	$("#eeg").html(pgData);
	        });
	        $.get("gait.html", {}, function(pgData){
	        	$("#gait").html(pgData);
	        });
	        $.get("fall.html", {}, function(pgData){
	        	$("#fall").html(pgData);
	        });

	    	$('#filepick').hide();


	    	//file loader
	    	var location = window.location.pathname;
        	var path = location.substring(1, location.lastIndexOf('/')+1);
	        $('#filepick').fileTree({ root: 'PatientData/', script: 'jqueryFileTree/connectors/jqueryFileTree.php', multiFolder: false }, function(file) { 
	        		//alert(file);
	        		//alert('trying loading');
	        		//if (dataAvailable) {
	        		if (file.substring(0,1) != 'x') { //Check for non-data-folder flag
	        			//file = file.slice(1);

	        			//Load all the data for all the visualizations
		                kinectSubfolder = file;
		                kinectLoadCoords();

			            eegFolder = file;
			            loadEEGdata();

			            gaitFolderpath = file;
			            loadGaitData();

			            fallDataFolder = file;
	            		fallLoadData();

	            		ecgDataFolder = file;
	            		ecgloadData(replaceTimeline); //when it's done loading, replace the timeline


	        		}

	        }, true, path); //True to only show folders

	        //Create timeline slider
			createSlider();


	    });

		function replaceTimeline() {
    		//Replace the timeline slider with one having an appropriate length for the new data
    		dataLength = heartrates.length;
    		fdSlider.destroySlider('timelineForm');
    		$('.fd-slider').remove();
			createSlider();
		}

	    function advanceTime() {
        	//Move the slider
        	if (!pause) {
        		var time = globalClock.getElapsedTime();
	        	$("#timelineForm").val(time *animMultiplier );
	        	fdSlider.updateSlider('timelineForm');
        	}

        	//Reset slider when it gets to the end
        	if ($("#timelineForm").val() >= dataLength) {
        		$("#timelineForm").val("0.0");
        		fdSlider.updateSlider('timelineForm');
        		globalClock = new THREE.Clock(); //Reset the clock
        	}

        	//Continue animation
        	window.requestAnimationFrame(advanceTime);
	    }

	    //Toggle timeline auto-advancing
	    function toggleTime() {
	    	if (pause) {
	    		globalClock.start();
	    	} else {
	    		globalClock.stop();
	    	}
	    	pause = !pause;
	    }

	    function createSlider() {
			fdSlider.createSlider({
			  // Associate the slider with the form element 
			  inp:document.getElementById("timelineForm"),
			  // A minimum value of 5
			  min:0,
			  // A maximum value of 15
			  max: dataLength,
			  // A step/increment of 0.2
			  step:1,
			  // Hide the input box
			  hideInput:true,
			  //
			  forceValue:true
			});

		    //Kickstart timeline
		    advanceTime();
	    }
	</script>

</head>


<body>

<div class="container">
	<div class="row">
		<div class="twelvecol last">
			<a href="#"><span id="loadLink"><b>Load</b></span></a>
			<h1>Data Visualization for Clinical Decision Support</h1>
		</div>
	</div>
</div>

<div class="fileDialog">
    <div id="filepick" class='fileselect'></div>
</div>

<script type="text/javascript">
    $('#loadLink').click( function() { //Toggle the file selection dialog
        $('#filepick').toggle();
    });
</script>

<div class="container">
	<div class="row">
		<div class="fourcol" id="kinect">
		</div>
		<div class="fourcol" id="ecg">
		</div>
		<div class="fourcol last" id="eeg">
		</div>
	</div>
</div>

<div class="container bottom">
	<div class="row">
		<div class="fourcol" id="fall">
		</div>
		<div class="fourcol" id="gait">
		</div>
		<div class="fourcol last">
			<p>Click and drag to move camera.<br/>
			Press <b>Spacebar</b> to revert all cameras to their original camera positions.</p>

			<p>Uses the Lee Perry-Smith head found <a href="http://www.ir-ltd.net/infinite-3d-head-scan-released/">here</a>.</p>
		</div>
	</div>
</div>

<div class="container" id="timeline">
	<div class="row">
		<!--<div class="twelvecol last">-->
		<p>
			<a href="#"><img src="icons/pause.png" id="pause"></a>
       		<script>
				$('#pause').click( function() {
					toggleTime();
				});
			 </script>
       		<!-- <input name="html5shim-1" id="html5shim-1" type="range" min="0" max="100" step="0.20" title="Timeline" value="0.0" /> -->
       		<input type="text" name="timelineForm" id="timelineForm" value="0" />
       		<script>
			 </script>
       	</p>

		<!--</div>-->
	</div>
</div>


</body>

</html>